- type: replace
  path: /instance_groups/name=api/jobs/name=route_registrar/properties/route_registrar/routes/name=api?/tls_port
  value: 9024

- type: replace
  path: /instance_groups/name=api/jobs/name=cloud_controller_ng/properties/cc/cc_gorouter_tls?/private_key
  value: "((cc_gorouter_tls.private_key))"

- type: replace
  path: /instance_groups/name=api/jobs/name=cloud_controller_ng/properties/cc/cc_gorouter_tls?/public_cert
  value: "((cc_gorouter_tls.certificate))"

- type: replace
  path: /instance_groups/name=api/jobs/name=cloud_controller_ng/properties/cc/cc_gorouter_tls?/ca_cert
  value: "((cc_gorouter_tls.ca))"

- type: replace
  path: /instance_groups/name=api/jobs/name=route_registrar/properties/route_registrar/routes/name=api?/server_cert_domain_san
  value: "https://api.((system_domain))"

- type: replace
  path: /instance_groups/name=router/jobs/name=gorouter/properties/router/ca_certs?
  value: ((service_cf_internal_ca.certificate))

- type: replace
  path: /instance_groups/name=router/jobs/name=gorouter/properties/router/backends?/enable_tls
  value: true

- type: replace
  path: /instance_groups/name=router/jobs/name=gorouter/properties/router/backends?/cert_chain
  value: "((gorouter_cc_tls.certificate))"

- type: replace
  path: /instance_groups/name=router/jobs/name=gorouter/properties/router/backends?/private_key
  value: "((gorouter_cc_tls.private_key))"

# TODO
# the thought is: we can probably restrict the alternative names so that they're not wildcards
# and we probably don't need extended key usage to be both client and server auth for these certificate blocks (?)
# ---> we do not yet know the minimal combination of properties that work together

- type: replace
  path: /variables/name=gorouter_cc_tls?
  value:
    name: gorouter_cc_tls
    type: certificate
    options:
      ca: service_cf_internal_ca
      common_name: "*.((system_domain))" # older comment: api.((system_domain)) doesn't work, neither does https://api.((system_domain))
      alternative_names:
      - "api.((system_domain))" # "*.((system_domain))" --> "api.((system_domain))" this worked!!!
      extended_key_usage:
      - client_auth
      - server_auth # older comment: when this is not here you get "http: proxy error: x509: certificate specifies an incompatible key usage" on router

- type: replace
  path: /variables/name=cc_gorouter_tls?
  value:
    name: cc_gorouter_tls
    type: certificate
    options:
      ca: service_cf_internal_ca
      common_name: "api.((system_domain))"
      alternative_names:
      - "*.((system_domain))"
      extended_key_usage:
      - client_auth
      - server_auth
